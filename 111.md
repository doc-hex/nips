NIP-111
=======

Addition Relay Information for NIP-11
-------------------------------------

`draft` `optional` `author:doc-hex`

Relays may provide addition metadata to clients to inform them of more detailed
limitations and policy choices. This is made available as additional
fields, in the a JSON document defined by [NIP-11](11.md). All are optional
and may be omitted.

All numbers and values show in the examples here, are merely examples
and do not consituite a default value or expectation. The purpose
of this NIP is to allow clients to directly discover the actual
values chosen by the relay operators.

Background
----------

Support for this NIP should be documented in the `supported_nips` list
of the same response.

```json
{
...
  supported_nips: <a list of NIP numbers supported by the relay, including this one>,
...
}
```

Server Limitiations
-------------------

These are limitations imposed by the server on clients. Your client
should expect that requests which exceed these *practical* limitations
are rejected or fail immediately.

```json
{
...
  limitation: {
        max_raw_json: 16384,
        max_subscriptions: 20,
        max_filters: 100,
        subid_length: 100,
  }
...
}
```

- `max_raw_json`: this is the maximum number of bytes for incoming JSON that the server
will attempt to decode and act upon. When you send large subscriptions, you will be
limited by this value. It also effectively limits the maximum size of any event. Value is
calulcated from `[` to `]` and is after UTF-8 serialization (so some unicode characters
will cost 2-3 bytes). It is equal to the maximum size of the WebSocket message frame.

- `max_subscriptions`: total number of subscriptions that may be
active on a single websocket conneciton to this relay. It's possible
that authenticated clients with a (paid) relationship to the server
may have higher limits.

- `max_filters`: maximum number of filter values per each subscription.
Must be one or higher.

- `subid_length`: maximum length of subscription id as a string.

As Nostr expands and develops, expect to see additional items added here.


Event Retention
---------------

There may be a cost associated with storing data forever, so relays 
may wish to state retention times. The values stated here are defaults
for unauthenticated users and visitors. Paid users would likely have
other policies.

Retention times are given in seconds, with the `null` value indicating
infinity. If zero is provided, this means the event will not be
stored at all, and preferably and error would be provided when those
are received.

```json
{
...
  retention: {
    default: 3600,
    by_kind: { 0: null, 2: null, 3: null, 4: 172800 },
  }
...
}
```

- the `default` is recommended, and indicated the retention time if not specified elsewhere. 
- `by_kind` is a dictionary mapping KIND values to their retention time. The example given
indicates that per-pubkey metadata will be store forever, and private DM's will be saved
for two days.

It is possible to effectively blacklist Nostr-based protocols that rely on
a specific KIND number, by using a retention time of zero for those KIND values.
While that is unfortunate, it does allow clients to discover servers that will
support their protocol quickly.


Content Limitations
-------------------

Some relays may be governed by the arbitrary laws of a nation state. This
may limit what content can be stored in cleartext on those relays. All
clients are encouraged to use encryption to work around this limitation.

It is not possible to describe the limitations of each country's laws
and policies which themselves are typically vague and constantly shifting.

Therefore, this field allows the relay operator to indicate which
country's' laws might end up being enforced on them, and then
indirectly on their users's content.

Users should be able to avoid relays in countries they don't like,
and/or select relays in more favourable zones. Exposing this
flexibility is up to the client software.

```json
{
...
  relay_countries: [ 'CA', 'US' ],
...
}
```

- `relay_countries`: a list of two-level ISO country codes (ISO 3166-1 alpha-2)  whose
  laws and policies may affect this relay. 

Remember that a relay may be hosted in a country which is not the
country of the legal entities who own the server, so it's very
likely a number of countries are involved.


Community Preferences
---------------------

For public text notes at least, a relay server may try to foster a
local community. This would encourge users to follow the global
feed on that relay, in addition to their usual individual follows.
To support this goal, relays MAY specific some of the following values.

```json
{
...
  language_tags: [ 'en', 'en-419' ],
  only_sfw: True,
  posting_policy: 'https://example.com/posting-policy.html',
...
}
```

- `language_tags` is an ordered list
  of [IETF language tags](https://en.wikipedia.org/wiki/IETF_language_tag) indicating
  the major languages spoken on the relay.
- `only_swf` is an boolean that only "Safe For Work" content is encouraged on this
  server. This is relies on assumptions of what the "work" "community" feels 
  "safe" talking about.
- `posting_policy` is a link to a human-readable page which specifies the
  community policies for the server. In cases where `only_sfw` is True, it's
  important to link to a page which gets into the specifics of your posting policy.


